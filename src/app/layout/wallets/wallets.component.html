<app-page-header [heading]="'View wallets from many exchanges in one place'"></app-page-header>
<div class="row">
    <div class="col-12">
        Requires API keys
    </div>
</div>
<div class="row">
    <div class="col-12">
        <button class="btn btn-sm btn-info mr-1 mb-1" (click)="refreshAllWallets()"
                [disabled]="pending">
            <i class="fa fa-refresh" [class.is-pending]="pending"></i> Refresh wallets
        </button>
        <button type="button" class="btn btn-sm mr-1 mb-1"
                (click)="flipBalancesViewType()">
            Show summary per user <i class="fa" [class.fa-toggle-on]="!showBalancesPerExchange"
                                     [class.fa-toggle-off]="showBalancesPerExchange"></i>
        </button>
        <button (click)="flipShowingUnderOneDollar()" type="button" class="btn btn-sm mb-1">
            Show small amounts <i class="fa" [class.fa-toggle-on]="showUnder1Dollar"
                                  [class.fa-toggle-off]="!showUnder1Dollar"></i>
        </button>
        <div class="text-muted ml-auto mb-1">
            <small>
                Last refresh: {{ (getLastWalletsRefreshTime() | date: 'y-MM-dd HH:mm:ss') || '-' }}
            </small>
        </div>
    </div>
</div>
<div>
    <div *ngFor="let exchangeUser of exchangeUsers" class="card mb-3 exchange-user-wallet">
        <div class="card-header">
            <div class="d-flex flex-row mb-2">
                <h3><i class="fa fa-user"></i> {{ exchangeUser.name }}</h3>
            </div>
            <h5>
            <span class="badge bg-secondary text-light m-1 p-1">
                    Total BTC: <span
                class="sensitive-data">{{ getTotalExchangeUserBtcValue(exchangeUser) | number : '1.8' || '-' }}</span>
                    <i class="fa fa-btc"></i>
            </span>
                <span class="badge bg-secondary text-light m-1 p-1">
                    Total USD:
                <span class="sensitive-data">
                {{ getTotalExchangeUserUsdValue(exchangeUser) | number : '1.2' || '-' }}
            </span>
                    <i class="fa fa-usd"></i>
            </span>
                <span class="badge bg-secondary m-1 p-1 text-light">
                1 <i class="fa fa-btc"></i> = <i class="fa fa-usd"></i> <span
                    class="sensitive-data">{{ get1BtcValue() | number : '1.2' || '-' }}</span>
            </span>
            </h5>
        </div>
        <div class="card-body">
            <ng-container *ngFor="let exchangeBalance of exchangeUser.exchangeBalances">
                <h4>{{ exchangeBalance.exchangeName }}</h4>
                <span *ngIf="exchangeBalance.errorMessage != null" class="badge badge-warning">
                    {{ exchangeBalance.errorMessage }}
                </span>
                <span *ngIf="exchangeBalance.currencyBalances.length == 0 && exchangeBalance.errorMessage == null"
                      class="alert balance-table mt-3">No currencies held</span>
                <div *ngIf="exchangeBalance.currencyBalances.length > 0 && exchangeBalance.errorMessage == null"
                     class="table-responsive mb-3">
                    <table class="table table-sm table-hover balance-table">
                        <thead>
                        <tr>
                            <th>Currency</th>
                            <th class="text-right">Available</th>
                            <th class="text-right">Frozen</th>
                            <th class="text-right">Total</th>
                            <th class="text-right">BTC Price</th>
                            <th class="text-right">BTC value <i class="fa fa-sort-amount-desc" aria-hidden="true"></i></th>
                            <th class="text-right">USD value</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr *ngFor="let currencyBalance of getSortedBalances(exchangeBalance.currencyBalances)">
                            <td class="sensitive-data">{{ currencyBalance.currencyCode }}</td>
                            <td class="text-right sensitive-data">{{ currencyBalance.available | number : '1.8-8' }}</td>
                            <td class="text-right sensitive-data">{{ currencyBalance.frozen | number : '1.8-8' }}</td>
                            <td class="text-right sensitive-data">{{ currencyBalance.total | number : '1.8-8' }}</td>
                            <td class="text-right sensitive-data">{{ currencyBalance.btcPrice | number : '1.8-8' }}</td>
                            <td class="text-right sensitive-data">{{ currencyBalance.btcValue | number : '1.8' || '-' }}
                            </td>
                            <td class="text-right sensitive-data">{{ currencyBalance.usdValue | number : '1.2' || '-' }}
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td class="text-right font-weight-bold sensitive-data">
                                {{ getTotalExchangeBtcValue(exchangeBalance) | number : '1.8' }}
                            </td>
                            <td class="text-right font-weight-bold sensitive-data">
                                {{ getTotalExchangeUsdValue(exchangeBalance) | number : '1.2' }}
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </ng-container>
        </div>
    </div>
</div>
