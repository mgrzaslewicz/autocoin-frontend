<app-page-header [heading]="'Manage automated trading strategies'" [icon]="'fa-magic'"></app-page-header>
<div class="row">
    <div class="col-xl-12">
        <div class="nav-item btn-group ml-auto" role="group">
            <button *ngIf="isShowingOnlyActiveStrategies"
                    (click)="showAllStrategies()"
                    class="btn btn-sm" type="button">
                Show only active <i class="fa fa-toggle-on"></i>
            </button>
            <button *ngIf="!isShowingOnlyActiveStrategies"
                    (click)="showOnlyActiveStrategies()"
                    class="btn btn-sm" type="button">
                Show only active <i class="fa fa-toggle-off"></i>
            </button>
        </div>
    </div>
</div>
<div class="card mb-3 bg-dark" *ngFor="let exchange of getExchangesSupportedForTrading()">
    <div class="card-header">
        <div class="row justify-content-between align-items-center px-2">
            <span>{{ exchange.name }}</span>
            <a *ngIf="isSupportedForTrading(exchange.name)"
               [routerLink]="['/trading-automation/add-strategy-execution', exchange.name]" class="btn btn-success">
                Add strategy
            </a>
            <button *ngIf="!isSupportedForTrading(exchange.name)" class="btn btn-secondary" disabled>
                Add strategy
            </button>
        </div>
    </div>
    <table *ngIf="getStrategiesExecutionsByExchangeName(exchange.name).length > 0"
           class="card-body table table-hover">
        <thead>
        <tr>
            <th>Autocoin user</th>
            <th>Strategy name</th>
            <th>Currency pair</th>
            <th>Status</th>
            <th>Parameters</th>
            <th>Created orders</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let strategyExecution of getStrategiesExecutionsByExchangeName(exchange.name)">
            <td>{{ getExchangeUserNameById(strategyExecution.exchangeUserId) }}</td>
            <td>{{ strategyExecution.strategyName }}</td>
            <td>{{ strategyExecution.baseCurrencyCode }}/{{ strategyExecution.counterCurrencyCode }}</td>
            <td>{{ strategyExecution.status }}</td>
            <td>
                <ul>
                    <li *ngFor="let item of  flattenParameters(strategyExecution.strategyParameters) | keyvalue">
                        {{ item.key }}: {{ item.value }}
                    </li>
                </ul>
            </td>
            <td>
                <div *ngIf="strategyExecution.orders.length == 0">-</div>
                <ul *ngFor="let order of strategyExecution.orders | keyvalue">
                    <li>
                        {{ order.key }}: {{ order.value }}
                    </li>
                </ul>
            </td>
            <td>
                <button *ngIf="strategyExecution.status === 'ACTIVE'"
                        (click)="deleteStrategyExecution(strategyExecution)"
                        class="btn btn-danger">
                    Delete strategy
                </button>
            </td>
        </tr>
        </tbody>
    </table>
</div>
